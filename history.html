<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IQ Test Pro - Ge√ßmi≈ü & Analitik</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .glass-card { padding: 1.25rem; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .stat-card {
            background: white;
            padding: 0.75rem 0.25rem;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border);
        }
        .stat-value { font-size: 1.1rem; font-weight: 800; color: var(--primary); }
        .stat-label { font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; font-weight: 600; display: block; }

        .charts-grid-elite {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        .chart-box {
            background: white;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 0.75rem;
        }
        .chart-title { font-size: 0.65rem; font-weight: 800; margin-bottom: 0.5rem; text-transform: uppercase; color: var(--text-muted); }
        .canvas-wrapper { height: 120px; position: relative; }

        .history-card-mini {
            background: #f8fafc;
            border-radius: 16px;
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            max-height: 180px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
        }
        .history-item:last-child { border-bottom: none; }
        .item-info { display: flex; flex-direction: column; gap: 2px; }
        .item-date { font-size: 0.65rem; color: var(--text-muted); }
        .item-iq { font-weight: 800; font-size: 0.9rem; color: var(--primary); }
        .cat-mini-badge { font-size: 0.5rem; padding: 1px 4px; border-radius: 3px; background: #fff; border: 1px solid var(--border); margin-right: 2px; }

        .history-actions-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; }
        .btn-mini-danger { background: #fef2f2; border: 1px solid #fecaca; color: #ef4444; padding: 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 700; cursor: pointer; }
        .btn-mini-secondary { background: white; border: 1px solid var(--border); color: var(--text-muted); padding: 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 700; cursor: pointer; }

        /* Mobile Fixes */
        @media (max-width: 600px) {
            .glass-card { padding: 1rem; }
            .charts-grid-elite {
                grid-template-columns: 1fr;
            }
            .canvas-wrapper { height: 140px; }
            .stats-grid { gap: 0.35rem; }
            .stat-value { font-size: 1rem; }
        }
        .chart-container-elite {
            background: white;
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-sm);
        }
        .chart-title {
            font-size: 0.9rem;
            font-weight: 800;
            color: var(--text);
            margin-bottom: 1.5rem;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <div class="app-container" style="max-width: 800px;">
        <div class="glass-card">
            <h1>üìä Analiz Paneli</h1>
            <p class="subtitle">Zihinsel geli≈üimin ve ge√ßmi≈ü performansƒ±n.</p>

            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-value" id="stat-best">-</span>
                    <span class="stat-label">En ƒ∞yi IQ</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stat-avg">-</span>
                    <span class="stat-label">Ortalama</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stat-total">-</span>
                    <span class="stat-label">Toplam Test</span>
                </div>
            </div>

            <div class="charts-grid-elite">
                <div class="chart-box">
                    <h3 class="chart-title">üìà Geli≈üim</h3>
                    <div class="canvas-wrapper"><canvas id="iqLineChart"></canvas></div>
                </div>
                <div class="chart-box">
                    <h3 class="chart-title">üï∏Ô∏è Analiz</h3>
                    <div class="canvas-wrapper"><canvas id="categoryRadarChart"></canvas></div>
                </div>
            </div>

            <div class="history-card-mini">
                <div id="history-list">
                    <!-- JavaScript ile dolacak -->
                </div>
                <div id="empty-msg" class="empty-state" style="display: none;">
                    Hen√ºz testiniz bulunmuyor.
                </div>
            </div>

            <div class="history-actions-row">
                <button class="btn-mini-danger" onclick="clearHistory()">üóëÔ∏è Temizle</button>
                <button class="btn-mini-secondary" onclick="window.close()">‚úñÔ∏è Kapat</button>
            </div>
        </div>
    </div>

    <script>
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('iq_elite_history') || '[]');
            const list = document.getElementById('history-list');
            const emptyMsg = document.getElementById('empty-msg');
            
            if (history.length === 0) {
                list.style.display = 'none';
                emptyMsg.style.display = 'block';
                return;
            }

            // ƒ∞statistikleri Hesapla
            const iqs = history.map(h => h.iq);
            const best = Math.max(...iqs);
            const avg = Math.round(iqs.reduce((a, b) => a + b, 0) / iqs.length);

            document.getElementById('stat-best').innerText = best;
            document.getElementById('stat-avg').innerText = avg;
            document.getElementById('stat-total').innerText = history.length;

            list.innerHTML = '';
            // Son eklenen en √ºstte
            const historyToDisplay = [...history].reverse();
            historyToDisplay.forEach(h => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                let catHtml = '';
                if (h.categories) {
                    Object.keys(h.categories).forEach(cat => {
                        catHtml += `<span class="cat-mini-badge">${cat}: ${h.categories[cat]}</span>`;
                    });
                }

                item.innerHTML = `
                    <div class="item-info">
                        <span style="font-weight: 700; font-size: 0.95rem;">${h.rank}</span>
                        <span class="item-date">${h.date}</span>
                        <div class="cat-badges">${catHtml}</div>
                    </div>
                    <div class="item-iq">${h.iq} IQ</div>
                `;
                list.appendChild(item);
            });

            renderCharts(history);
        }

        function renderCharts(history) {
            const ctxLine = document.getElementById('iqLineChart').getContext('2d');
            const ctxRadar = document.getElementById('categoryRadarChart').getContext('2d');

            // Line Chart: IQ Progress
            new Chart(ctxLine, {
                type: 'line',
                data: {
                    labels: history.map((_, i) => `${i + 1}. Test`),
                    datasets: [{
                        label: 'IQ Skoru',
                        data: history.map(h => h.iq),
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#6366f1',
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: false, grid: { color: '#f1f5f9' } },
                        x: { grid: { display: false } }
                    }
                }
            });

            // Radar Chart: Category Averages
            const cats = ['Mantƒ±k', 'Matematik', 'G√∂rsel', 'S√∂zel'];
            const catData = cats.map(cat => {
                const total = history.reduce((acc, curr) => acc + (curr.categories[cat] || 0), 0);
                return total / history.length;
            });

            new Chart(ctxRadar, {
                type: 'radar',
                data: {
                    labels: cats,
                    datasets: [{
                        label: 'Ba≈üarƒ± Oranƒ±',
                        data: catData,
                        backgroundColor: 'rgba(168, 85, 247, 0.2)',
                        borderColor: '#a855f7',
                        borderWidth: 2,
                        pointBackgroundColor: '#a855f7'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 5, // Her kategori 5 soru varsayƒ±yoruz
                            ticks: { display: false }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function clearHistory() {
            if (confirm('T√ºm test ge√ßmi≈üinizi silmek istediƒüinize emin misiniz?')) {
                localStorage.removeItem('iq_elite_history');
                location.reload();
            }
        }

        window.onload = loadHistory;
    </script>
</body>
</html>
